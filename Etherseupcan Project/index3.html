<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
    <title>Document</title>
    <script type="text/javascript" src="./lib/bignumber.min.js"></script>
    <script type="text/javascript" src="./lib/web3.js"></script>

</head>

<body>
    <div class="container row">
        <div class="input-group col-3">
            <!-- <div class="input-group mb-3"> -->
            <input id="input_blocknumber" type="text" class="form-control" placeholder="Recipient's username"
                aria-label="Recipient's username" aria-describedby="button-addon2" />

            <button class="btn btn-primary" type="button" id="button-addon2" onclick="getBlockNumber();">
                Button
            </button>
        </div>
        <div class="input-group col-3">
            <!-- <div class="input-group mb-3"> -->
            <button class="btn btn-primary" type="button" id="button-addon2" onclick="increment();">
                Increment
            </button>
            <input id="input_count" type="text" class="form-control" placeholder="Current Count" />
            <button class="btn btn-primary" type="button" id="button-addon2" onclick="getCount();">
                Button
            </button>
        </div>
    </div>

</body>
<script type="text/javascript">
    if (typeof web3 !== "undefined") {
        web3 = new Web3(web3.currentProvider);
    } else {
        // set the provider you want from Web3.providers
        web3 = new Web3(
            new Web3.providers.HttpProvider("http://localhost:8545")
        );
    }

    if (web3.isConnected()) {
        console.log("connected");
    } else {
        console.log("not connected");
    }

    web3.eth.defaultAccount = web3.eth.accounts[0];

    let abi = [{
            "inputs": [],
            "name": "getBlockNumber",
            "outputs": [{
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [],
            "name": "getCount",
            "outputs": [{
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
            }],
            "stateMutability": "view",
            "type": "function"
        },
        {
            "inputs": [{
                "internalType": "uint256",
                "name": "_count",
                "type": "uint256"
            }],
            "name": "increment",
            "outputs": [],
            "stateMutability": "nonpayable",
            "type": "function"
        }
    ];

    let contractAddress = "0xc76f32ac931Db5fDC5178116a67d298879D3e1b9";
    let contractAddress2 = "0x0F3F9dae3f93be5d09F4483bbc119a2B6BE9eb00";


    let smartContract = web3.eth.contract(abi).at(contractAddress);
    console.log(smartContract);

    let smartContract2 = web3.eth.contract(abi).at(contractAddress2);
    console.log(smartContract2);

    function increment() {
        // let _count = document.getElementById("input_increment").value;
        // console.log(_count);

        smartContract2.increment.sendTransaction(function (error, hash) {
            // console.log(hash);
            // getCount();
        });

    }

    function getCount() {
        smartContract2.getCount.call(function (error, result) {
            console.log(result.toNumber());

            currentCount = result.toNumber();
            document.getElementById("input_count").value = currentCount;
        })


    }

    function getBlockNumber() {
        let currentBlockNumber;

        smartContract.getBlockNumber.call(function (error, result) {
            // console.log(result);
            console.log(result.toNumber());

            currentBlockNumber = result.toNumber();
            document.getElementById("input_blocknumber").value = currentBlockNumber;
        })

    }
</script>

</html>